<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“š ÙÙ‡Ø±Ø³ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® Ø¨Ø³Ø§Ù… Ø¬Ø±Ø§Ø±</title>

<!-- ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ· Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
<style>
body{font-family:"Segoe UI",Tahoma,Arial;line-height:1.8;background:#f9f9f9;padding:24px}
h1{margin:0 0 24px;text-align:center}
.search-box{max-width:600px;margin:auto}
#query{width:100%;padding:12px;font-size:18px;border:1px solid #ccc;border-radius:8px}
.result{background:#fff;padding:12px;margin:12px 0;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.08)}
.result b{display:block;margin-bottom:4px}
.result a{color:#0069c2;text-decoration:none}
.no-results{color:#c00;font-weight:bold;margin-top:24px;text-align:center}
.follow-up{margin-top:24px;font-style:italic;text-align:center}
</style>
</head>

<body>
<h1>ğŸ“š ÙÙ‡Ø±Ø³ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® Ø¨Ø³Ø§Ù… Ø¬Ø±Ø§Ø±</h1>

<div class="search-box">
  <input id="query" placeholder="Ø§ÙƒØªØ¨ Ù…ØµØ·Ù„Ø­ Ø§Ù„Ø¨Ø­Ø« Ø«Ù… Ø§Ø¶ØºØ· Enter ğŸ”">
</div>

<div id="results"></div>

<!-- ğŸ“ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ­Ù…Ù‘ÙÙ„ Ù…Ù† lessons.json (Ù…ÙØ³ØªØ®Ø±ÙØ¬Ø© Ù…Ù† Excel) -->
<script>
/*----------------------------------------------------------------------------------
  1- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
----------------------------------------------------------------------------------*/
let LESSONS = [];             // ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
let SURAH_SET = new Set();    // Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ± Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø±ÙƒÙ‘Ø¨
fetch('lessons.json').then(r=>r.json()).then(data=>{
  LESSONS = data;
  data.forEach(r => SURAH_SET.add(normalize(r["Surah Name"] || "")));
});

/*----------------------------------------------------------------------------------
  2- Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªÙˆØ³Ù‘Ø¹ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…Ù‰ (Ù…Ø³Ù…ÙˆØ­ Ù„Ø£Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¯Ø§Ø®Ù„ÙŠÙ‘Ø©)
----------------------------------------------------------------------------------*/
const CONCEPT_MAP = {
  "Ø§Ù„Ø£Ø®Ù„Ø§Ù‚":["Ø§Ù„ØµØ¯Ù‚","Ø§Ù„Ø£Ù…Ø§Ù†Ø©","Ø§Ù„Ø¹Ø¯Ù„","Ø§Ù„Ø­ÙŠØ§Ø¡","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ØªÙˆØ§Ø¶Ø¹"]
  // Ø£Ø¶Ù Ø£Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
};

/*----------------------------------------------------------------------------------
  3- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
----------------------------------------------------------------------------------*/
// Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„ + ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù‡ÙÙ…Ù’Ø²Ø§Øª + ÙŠ/Ù‰ + Ù…Ø³Ø§ÙØ§Øª Ø²Ø§Ø¦Ø¯Ø©
function normalize(str=""){
  return str
    .replace(/[\u064B-\u0652]/g,"")        // Ø­Ø±ÙƒØ§Øª
    .replace(/[Ø£Ø¥Ø¢Ù±]/g,"Ø§")
    .replace(/Ù‰/g,"ÙŠ")
    .replace(/[^\u0621-\u064A0-9\s]/g,"") // Ø±Ù…ÙˆØ² Ø²Ø§Ø¦Ø¯Ø©
    .replace(/\s+/g," ")
    .trim();
}

// Ù‡Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙŠØ­ØªÙˆÙ‰ Ø±Ù‚Ù…Ù‹Ø§ (Ø¨Ø­Ø« Ù…Ø±ÙƒÙ‘Ø¨ Ø³ÙˆØ±Ø©+Ø¢ÙŠØ©)ØŸ
function parseCompound(q){
  const words = q.split(" ");
  const num   = words.find(w=>/^\d+$/.test(w));
  if(!num) return null;

  const name = words.filter(w=>w!==num).join(" ");
  return { surah: normalize(name), verse: num };
}

// ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
function rank(type){
  return {exact:0,normalized:1,compound:2,semantic:3}[type] || 4;
}

/*----------------------------------------------------------------------------------
  4- Ø¢Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠÙ‘Ø©
----------------------------------------------------------------------------------*/
function search(qRaw){
  const qExact = qRaw.trim();
  const qNorm  = normalize(qExact);
  const compound = parseCompound(qNorm);

  let hits = [];

  //â€ŠØ£) Ù…Ø·Ø§Ø¨Ù‚Ø© Ø­Ø±ÙÙŠÙ‘Ø© ÙƒØ§Ù…Ù„Ø©
  LESSONS.forEach(r=>{
    if((r.Index||"").includes(qExact)){
      hits.push({r,type:"exact"});
    }
  });

  //â€ŠØ¨) ØªØ·Ø¨ÙŠØ¹ Ø­Ø±ÙˆÙÙ‰ Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø´ÙŠØ¦Ù‹Ø§
  if(!hits.length){
    LESSONS.forEach(r=>{
      if(normalize(r.Index||"").includes(qNorm)){
        hits.push({r,type:"normalized"});
      }
    });
  }

  //â€ŠØ¬) Ø¨Ø­Ø« Ù…Ø±ÙƒÙ‘Ø¨ (Ø³ÙˆØ±Ø© + Ø±Ù‚Ù… Ø¢ÙŠØ©)
  if(!hits.length && compound && SURAH_SET.has(compound.surah)){
    LESSONS.forEach(r=>{
      if(normalize(r["Surah Name"]||"")===compound.surah &&
         String(r["Verse No"]).replace(/\.0$/,"")===compound.verse){
        hits.push({r,type:"compound"});
      }
    });
  }

  //â€ŠØ¯) ØªÙˆØ³Ù‘Ø¹ Ù…ÙÙ‡ÙˆÙ…Ù‰
  if(!hits.length && CONCEPT_MAP[qExact]){
    CONCEPT_MAP[qExact].forEach(term=>{
      LESSONS.forEach(r=>{
        if(normalize(r.Index||"").includes(normalize(term))){
          hits.push({r,type:"semantic"});
        }
      });
    });
  }

  //â€ŠÙ‡) ØªØ±ØªÙŠØ¨ ÙˆØ¥Ø®Ø±Ø§Ø¬
  hits.sort((a,b)=>rank(a.type)-rank(b.type));
  return hits;
}

/*----------------------------------------------------------------------------------
  5- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø³Ø¤Ø§Ù„ Ù…ÙÙ‚ØªØ±ÙØ­
----------------------------------------------------------------------------------*/
function show(hits,q){
  const box = document.getElementById("results");
  box.innerHTML = "";

  if(!hits.length){
    box.innerHTML =
      `<div class="no-results">âš ï¸ Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù…ÙˆØ¶ÙˆØ¹Ùƒ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø¨Ø¥Ù…ÙƒØ§Ù†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ© Ø£Ùˆ ØªØ¬Ø±Ø¨Ø© Ù…ØµØ·Ù„Ø­Ø§Øª Ø°Ø§Øª ØµÙ„Ø©.</div>`;
    return;
  }

  hits.forEach(({r})=>{
    const minute = r.Minute || "";
    const link   = r["Link to Minute"] || "#";
    box.innerHTML += `
      <div class="result">
        <b>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³:</b> ${r["Lesson Name "]||""}
        <b>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</b> ${r.Index||""}
        <b>Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©:</b> ${minute}
        <b><a href="${link}" target="_blank">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© â–¶ï¸</a></b>
      </div>`;
  });

  //â€ŠØ§Ù‚ØªØ±Ø§Ø­ Ø³Ø¤Ø§Ù„ ØªØ§Ø¨Ø¹ (ÙƒÙ„Ù…Ø© Ù…Ø¬Ø§ÙˆØ±Ø©)
  const words = q.split(" ");
  if(words.length===1 && hits.length){
    const alt = normalize(hits[0].r.Index||"").split(" ").find(w=>w!==normalize(q));
    if(alt){
      box.innerHTML += `<div class="follow-up">ğŸ¤” Ù‡Ù„ ØªÙ‚ØµØ¯: <strong>${alt}</strong>ØŸ</div>`;
    }
  }
}

/*----------------------------------------------------------------------------------
  6- Ø±Ø¨Ø· Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ â†” Ø§Ù„Ø¨Ø­Ø«
----------------------------------------------------------------------------------*/
document.getElementById("query").addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    const q = e.target.value;
    show(search(q),q);
  }
});
</script>
</body>
</html>
