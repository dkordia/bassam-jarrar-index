<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ“š ÙÙ‡Ø±Ø³ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® Ø¨Ø³Ø§Ù… Ø¬Ø±Ø§Ø±</title>

<style>
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --primary:#0f766e;
  --primary-dark:#115e59;
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{font-family:"Segoe UI",Tahoma,Arial;line-height:1.8;background:var(--bg);margin:0;color:var(--text)}
header{padding:32px 20px 12px;text-align:center}
h1{margin:0 0 8px;font-size:32px}
.subtitle{color:var(--muted);margin:0;font-size:16px}
main{max-width:900px;margin:0 auto;padding:0 20px 40px}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 12px 25px rgba(15,23,42,.06);padding:20px}
.search-panel{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin-top:20px}
#query{flex:1;min-width:220px;padding:12px 14px;font-size:18px;border:1px solid var(--border);border-radius:10px}
.btn{border:none;border-radius:10px;padding:12px 18px;font-size:16px;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-dark)}
.btn-ghost{background:#fff;border:1px solid var(--border);color:var(--muted)}
.stats{display:flex;flex-wrap:wrap;gap:16px;margin-top:16px;color:var(--muted);font-size:14px}
.stats span{background:#f9fafb;border-radius:999px;padding:6px 12px;border:1px dashed var(--border)}
.results-header{display:flex;justify-content:space-between;align-items:center;margin:24px 0 8px;flex-wrap:wrap;gap:8px}
.results-header p{margin:0;color:var(--muted)}
.result{background:#fff;padding:14px 16px;margin:12px 0;border-radius:12px;border:1px solid var(--border)}
.result b{display:block;margin-bottom:4px}
.result a{color:var(--primary);text-decoration:none}
.result a:hover{text-decoration:underline}
.no-results{color:#b42318;text-align:center;font-weight:bold;margin-top:24px}
.follow-up{margin-top:24px;text-align:center;font-style:italic;color:var(--muted)}
.tips{margin-top:14px;color:var(--muted);font-size:14px}
</style>
</head>

<body>
<header>
  <h1>ğŸ“š ÙÙ‡Ø±Ø³ Ø¯Ø±ÙˆØ³ Ø§Ù„Ø´ÙŠØ® Ø¨Ø³Ø§Ù… Ø¬Ø±Ø§Ø±</h1>
  <p class="subtitle">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ø³ÙˆØ±Ø© Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ù„ØªØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨.</p>
</header>

<main>
  <section class="card">
    <div class="search-panel">
      <input id="query" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø©ØŒ Ù…ÙˆØ¶ÙˆØ¹Ù‹Ø§ØŒ Ø£Ùˆ ØµÙŠØºØ© Ù…Ø«Ù„: Ø§Ù„Ù†Ø³Ø§Ø¡ 34">
      <button class="btn btn-primary" id="searchBtn">Ø¨Ø­Ø«</button>
      <button class="btn btn-ghost" id="clearBtn">Ù…Ø³Ø­</button>
    </div>
    <div class="stats" id="stats">
      <span>â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</span>
    </div>
    <p class="tips">Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡ØŒ Ø¢ÙŠØ§ØªØŒ Ø³ÙˆØ±Ø© ÙŠÙˆØ³Ù 12ØŒ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ù† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³.</p>
  </section>

  <div class="results-header">
    <h2>Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
    <p id="resultsCount">â€”</p>
  </div>
  <div id="results"></div>
</main>

<script>
/*------------------------------------------------------------------------
  1) ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§ØªØ§ (lessons + concepts)
------------------------------------------------------------------------*/
let LESSONS=[], CONCEPTS={}, SURAH_SET=new Set();

Promise.all([
  fetch('lessons.json').then(r=>r.json()),
  fetch('concepts.json').then(r=>r.json())
]).then(([lessons,concepts])=>{
  LESSONS=lessons;
  CONCEPTS=concepts;
  lessons.forEach(r=>{
    r._normIndex=normalize(r.Index||"");      // Ù†Ø³Ø®Ø© Ù…Ù‡ÙŠÙ‘ÙØ£Ø© Ù„Ù„ØªØ³Ø±ÙŠØ¹
    SURAH_SET.add(normalize(r["Surah Name"]||""));
  });
  document.getElementById("stats").innerHTML=`
    <span>ğŸ“Œ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø±ÙˆØ³: ${lessons.length}</span>
    <span>ğŸ“– Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙˆØ±: ${SURAH_SET.size}</span>
    <span>ğŸ” Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø­Ø«</span>
  `;
}).catch(err=>{
  document.getElementById("results").innerHTML=
    `<div class="no-results">âš ï¸ Ø®Ø·Ø£ ÙÙ‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª: ${err}</div>`;
});

/*------------------------------------------------------------------------
  2) Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠØ¹ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„
------------------------------------------------------------------------*/
function normalize(str=""){
  return str.replace(/[\u064B-\u0652]/g,"")       // Ø­Ø±ÙƒØ§Øª
            .replace(/[Ø£Ø¥Ø¢Ù±]/g,"Ø§")               // Ù‡Ù…Ø²Ø§Øª
            .replace(/Ù‰/g,"ÙŠ")                    // Ù‰ â†” ÙŠ
            .replace(/[^\u0621-\u064A0-9\s]/g,"") // Ø±Ù…ÙˆØ²
            .replace(/\s+/g," ")
            .trim();
}

const prefixes=["Ø§Ù„","Ø¨Ø§Ù„","ÙƒØ§Ù„","ÙˆØ§Ù„","ÙØ§Ù„","Ù„Ù„","Ø³","Ùˆ"];
const suffixes=["Ù‡","Ù‡Ø§","Ù‡Ù…","ÙƒÙ…Ø§","Ù†Ø§","ÙƒÙ…","ÙƒÙ†","ÙŠØ©","Ø§Ù†","ÙˆÙ†","Ø§Øª","ÙŠÙ†","Ø§","ÙŠ"];
function lightStem(word){
  let w=word;
  prefixes.forEach(p=>{if(w.startsWith(p)&&w.length>p.length+2)w=w.slice(p.length);});
  suffixes.forEach(s=>{if(w.endsWith(s)&&w.length>s.length+2)w=w.slice(0,-s.length);});
  return w;
}

/*------------------------------------------------------------------------
  3) Ø¬Ù…Ø¹ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù‘ÙØ¹Ø©
------------------------------------------------------------------------*/
function collectTerms(qRaw){
  const set=new Set();
  set.add(qRaw);
  (CONCEPTS[qRaw]||[]).forEach(v=>set.add(v));
  qRaw.split(" ").forEach(w=>set.add(lightStem(w)));
  return [...set].map(normalize);
}

/*------------------------------------------------------------------------
  4) ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø±ÙƒÙ‘ÙØ¨ (Ø³ÙˆØ±Ø© + Ø±Ù‚Ù…)
------------------------------------------------------------------------*/
function parseCompound(q){
  const words=q.split(" ");
  const num=words.find(w=>/^\d+$/.test(w));
  if(!num)return null;
  const name=words.filter(w=>w!==num).join(" ");
  return {surah:normalize(name),verse:num};
}

/*------------------------------------------------------------------------
  5) Ø§Ù„Ø¨Ø­Ø« ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
------------------------------------------------------------------------*/
const weight={exact:0,normalized:1,compound:2,semantic:3};

function search(qRaw){
  const qNorm=normalize(qRaw);
  const compound=parseCompound(qNorm);
  const termSet=collectTerms(qRaw);
  const hits=[];

  LESSONS.forEach(r=>{
    if((r.Index||"").includes(qRaw))
      hits.push({r,type:"exact"});
    else if(r._normIndex.includes(qNorm))
      hits.push({r,type:"normalized"});
    else if(compound &&
            normalize(r["Surah Name"]||"")===compound.surah &&
            String(r["Verse No"]).replace(/\.0$/,"")===compound.verse)
      hits.push({r,type:"compound"});
    else{
      for(const term of termSet){
        if(r._normIndex.includes(term)){
          hits.push({r,type:"semantic"});
          break;
        }
      }
    }
  });

  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±
  const seen=new Set();
  const unique=hits.filter(h=>{
    const key=h.r["Lesson Name "]+"|"+h.r.Minute;
    if(seen.has(key))return false;
    seen.add(key);return true;
  });

  return unique.sort((a,b)=>weight[a.type]-weight[b.type]);
}

/*------------------------------------------------------------------------
  6) Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
------------------------------------------------------------------------*/
function show(hits,q){
  const box=document.getElementById("results");
  const count=document.getElementById("resultsCount");
  box.innerHTML="";
  if(!hits.length){
    count.textContent="0 Ù†ØªÙŠØ¬Ø©";
    box.innerHTML='<div class="no-results">âš ï¸ Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù…ÙˆØ¶ÙˆØ¹Ùƒ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø¨Ø¥Ù…ÙƒØ§Ù†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙŠØ§ØºØ© Ø£Ùˆ ØªØ¬Ø±Ø¨Ø© Ù…ØµØ·Ù„Ø­Ø§Øª Ø°Ø§Øª ØµÙ„Ø©.</div>';
    return;
  }
  count.textContent=`${hits.length} Ù†ØªÙŠØ¬Ø©`;
  hits.forEach(({r})=>{
    box.innerHTML+=`
      <div class="result">
        <b>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³:</b> ${r["Lesson Name "]||""}
        <b>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</b> ${r.Index||""}
        <b>Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©:</b> ${r.Minute||""}
        <b><a href="${r["Link to Minute"]||"#"}" target="_blank">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© â–¶ï¸</a></b>
      </div>`;
  });

  // Ø§Ù‚ØªØ±Ø§Ø­ Ø³Ø¤Ø§Ù„ ØªØ§Ø¨Ø¹
  const words=q.split(" ");
  if(words.length===1&&hits.length){
    const alt=normalize(hits[0].r.Index||"").split(" ").find(w=>w!==normalize(q));
    if(alt){
      box.innerHTML+=`<div class="follow-up">ğŸ¤” Ù‡Ù„ ØªÙ‚ØµØ¯: <strong>${alt}</strong>ØŸ</div>`;
    }
  }
}

/*------------------------------------------------------------------------
  7) Ø±Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø²Ø± Enter
------------------------------------------------------------------------*/
function runSearch(){
  const input=document.getElementById("query");
  const q=input.value.trim();
  if(q)show(search(q),q);
}

document.getElementById("query").addEventListener("keydown",e=>{
  if(e.key==="Enter")runSearch();
});

document.getElementById("searchBtn").addEventListener("click",runSearch);
document.getElementById("clearBtn").addEventListener("click",()=>{
  document.getElementById("query").value="";
  document.getElementById("results").innerHTML="";
  document.getElementById("resultsCount").textContent="â€”";
});
</script>
</body>
</html>
